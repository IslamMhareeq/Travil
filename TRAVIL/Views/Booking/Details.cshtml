@{
    ViewData["Title"] = "Package Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --color-midnight: #0a0a0f;
        --color-navy: #12121a;
        --color-slate: #1e1e2d;
        --color-steel: #6b7280;
        --color-silver: #9ca3af;
        --color-white: #ffffff;
        --color-gold: #d4a853;
        --color-gold-muted: rgba(212, 168, 83, 0.15);
        --color-success: #10b981;
        --color-error: #ef4444;
        --font-display: 'Playfair Display', serif;
        --font-body: 'Plus Jakarta Sans', sans-serif;
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        --space-1: 4px;
        --space-2: 8px;
        --space-3: 12px;
        --space-4: 16px;
        --space-5: 24px;
        --space-6: 32px;
        --space-8: 48px;
        --transition-fast: 0.2s ease;
    }

    .package-details-page {
        background: linear-gradient(135deg, var(--color-midnight) 0%, var(--color-navy) 100%);
        min-height: 100vh;
    }

    /* Hero Section */
    .package-hero {
        position: relative;
        height: 60vh;
        min-height: 400px;
        overflow: hidden;
    }

    .hero-image {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
    }

        .hero-image::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(10,10,15,0.3) 0%, rgba(10,10,15,0.9) 100%);
        }

    .hero-content {
        position: relative;
        z-index: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: var(--space-8);
        max-width: 1400px;
        margin: 0 auto;
    }

    .package-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-4);
        background: var(--color-gold);
        color: var(--color-midnight);
        border-radius: var(--radius-lg);
        font-size: 0.8125rem;
        font-weight: 600;
        margin-bottom: var(--space-4);
        width: fit-content;
    }

    .sale-badge {
        background: var(--color-error);
        color: white;
    }

    .package-title {
        font-family: var(--font-display);
        font-size: 3.5rem;
        font-weight: 600;
        color: var(--color-white);
        margin-bottom: var(--space-3);
    }

    .package-location {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        color: var(--color-silver);
        font-size: 1.25rem;
    }

        .package-location i {
            color: var(--color-gold);
        }

    /* Main Content */
    .package-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 var(--space-6) var(--space-8);
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: var(--space-6);
        margin-top: calc(-1 * var(--space-8));
        position: relative;
        z-index: 2;
    }

    /* Info Cards */
    .info-card {
        background: var(--color-navy);
        border: 1px solid var(--color-slate);
        border-radius: var(--radius-xl);
        padding: var(--space-6);
        margin-bottom: var(--space-5);
    }

    .info-card-title {
        font-family: var(--font-display);
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--color-white);
        margin-bottom: var(--space-5);
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }

        .info-card-title i {
            color: var(--color-gold);
        }

    /* Quick Info */
    .quick-info {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-4);
        margin-bottom: var(--space-5);
    }

    .quick-info-item {
        text-align: center;
        padding: var(--space-4);
        background: var(--color-slate);
        border-radius: var(--radius-md);
    }

        .quick-info-item i {
            font-size: 1.5rem;
            color: var(--color-gold);
            margin-bottom: var(--space-2);
        }

        .quick-info-item span {
            display: block;
            font-size: 0.8125rem;
            color: var(--color-steel);
            margin-bottom: var(--space-1);
        }

        .quick-info-item strong {
            display: block;
            font-size: 1rem;
            color: var(--color-white);
        }

    /* Description */
    .package-description {
        color: var(--color-silver);
        line-height: 1.7;
    }

    /* Itinerary */
    .itinerary-list {
        list-style: none;
    }

    .itinerary-item {
        display: flex;
        gap: var(--space-4);
        padding: var(--space-4) 0;
        border-bottom: 1px solid var(--color-slate);
    }

        .itinerary-item:last-child {
            border-bottom: none;
        }

    .itinerary-day {
        flex-shrink: 0;
        width: 60px;
        height: 60px;
        background: var(--color-gold-muted);
        border-radius: var(--radius-md);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

        .itinerary-day span {
            font-size: 0.6875rem;
            color: var(--color-gold);
            text-transform: uppercase;
        }

        .itinerary-day strong {
            font-size: 1.5rem;
            color: var(--color-gold);
        }

    .itinerary-content h4 {
        font-size: 1rem;
        color: var(--color-white);
        margin-bottom: var(--space-1);
    }

    .itinerary-content p {
        font-size: 0.875rem;
        color: var(--color-silver);
    }

    /* Booking Card */
    .booking-card {
        background: var(--color-navy);
        border: 1px solid var(--color-slate);
        border-radius: var(--radius-xl);
        padding: var(--space-6);
        position: sticky;
        top: var(--space-5);
    }

    .price-display {
        margin-bottom: var(--space-5);
    }

    .price-current {
        font-family: var(--font-display);
        font-size: 2.5rem;
        font-weight: 600;
        color: var(--color-gold);
    }

    .price-original {
        font-size: 1.25rem;
        color: var(--color-steel);
        text-decoration: line-through;
        margin-left: var(--space-3);
    }

    .price-per {
        font-size: 0.875rem;
        color: var(--color-silver);
    }

    .discount-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        background: rgba(239, 68, 68, 0.15);
        color: var(--color-error);
        border-radius: var(--radius-sm);
        font-size: 0.8125rem;
        font-weight: 600;
        margin-top: var(--space-2);
    }

    .booking-form-group {
        margin-bottom: var(--space-4);
    }

        .booking-form-group label {
            display: block;
            font-size: 0.875rem;
            color: var(--color-silver);
            margin-bottom: var(--space-2);
        }

    .room-selector {
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }

    .qty-btn {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--color-slate);
        background: var(--color-slate);
        color: var(--color-white);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
    }

        .qty-btn:hover {
            border-color: var(--color-gold);
            color: var(--color-gold);
        }

    .qty-value {
        min-width: 60px;
        text-align: center;
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--color-white);
    }

    .availability {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-3);
        background: rgba(16, 185, 129, 0.15);
        border-radius: var(--radius-md);
        color: var(--color-success);
        font-size: 0.875rem;
        margin-bottom: var(--space-5);
    }

        .availability.limited {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        .availability.sold-out {
            background: rgba(239, 68, 68, 0.15);
            color: var(--color-error);
        }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }

    .btn-book {
        width: 100%;
        padding: var(--space-4);
        background: transparent;
        border: 2px solid var(--color-gold);
        color: var(--color-gold);
        border-radius: var(--radius-md);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
    }

        .btn-book:hover {
            background: var(--color-gold-muted);
        }

    .btn-buy-now {
        width: 100%;
        padding: var(--space-5);
        background: linear-gradient(135deg, var(--color-gold) 0%, #c49a47 100%);
        border: none;
        color: var(--color-midnight);
        border-radius: var(--radius-md);
        font-size: 1.125rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
    }

        .btn-buy-now:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 168, 83, 0.3);
        }

        .btn-buy-now:disabled, .btn-book:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

    .btn-add-cart {
        width: 100%;
        padding: var(--space-3);
        background: var(--color-slate);
        border: 1px solid var(--color-steel);
        color: var(--color-silver);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
    }

        .btn-add-cart:hover {
            border-color: var(--color-gold);
            color: var(--color-gold);
        }

    .btn-waitlist {
        width: 100%;
        padding: var(--space-4);
        background: var(--color-slate);
        border: 1px solid var(--color-steel);
        color: var(--color-silver);
        border-radius: var(--radius-md);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
    }

        .btn-waitlist:hover {
            border-color: var(--color-gold);
            color: var(--color-gold);
        }

    .secure-notice {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        margin-top: var(--space-4);
        color: var(--color-steel);
        font-size: 0.8125rem;
    }

        .secure-notice i {
            color: var(--color-success);
        }

    /* Toast */
    .toast {
        position: fixed;
        bottom: var(--space-5);
        right: var(--space-5);
        padding: var(--space-4) var(--space-5);
        background: var(--color-navy);
        border: 1px solid var(--color-slate);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        gap: var(--space-3);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
        color: var(--color-white);
    }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--color-success);
        }

            .toast.success i {
                color: var(--color-success);
            }

        .toast.error {
            border-color: var(--color-error);
        }

            .toast.error i {
                color: var(--color-error);
            }

    /* Loading */
    .loading-state {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 50vh;
    }

    .spinner {
        width: 48px;
        height: 48px;
        border: 3px solid var(--color-slate);
        border-top-color: var(--color-gold);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @@keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* Responsive */
    @@media (max-width: 900px) {
        .package-content {
            grid-template-columns: 1fr;
        }

        .booking-card {
            position: static;
        }

        .package-title {
            font-size: 2.5rem;
        }

        .quick-info {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @@media (max-width: 600px) {
        .hero-content {
            padding: var(--space-5);
        }

        .package-title {
            font-size: 2rem;
        }

        .package-content {
            padding: 0 var(--space-4) var(--space-6);
        }
    }
</style>

<div class="package-details-page">
    <!-- Loading State -->
    <div class="loading-state" id="loadingState">
        <div class="spinner"></div>
    </div>

    <!-- Main Content (hidden initially) -->
    <div id="packageContent" style="display: none;">
        <!-- Hero Section -->
        <div class="package-hero">
            <div class="hero-image" id="heroImage"></div>
            <div class="hero-content">
                <div class="package-badge" id="typeBadge">Adventure</div>
                <div class="package-badge sale-badge" id="saleBadge" style="display: none;">
                    <i class="fas fa-tag"></i> On Sale
                </div>
                <h1 class="package-title" id="packageTitle">Loading...</h1>
                <div class="package-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="packageCountry">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="package-content">
            <!-- Left Column -->
            <div>
                <!-- Quick Info -->
                <div class="info-card">
                    <div class="quick-info">
                        <div class="quick-info-item">
                            <i class="far fa-calendar"></i>
                            <span>Duration</span>
                            <strong id="duration">-</strong>
                        </div>
                        <div class="quick-info-item">
                            <i class="fas fa-door-open"></i>
                            <span>Available</span>
                            <strong id="rooms">-</strong>
                        </div>
                        <div class="quick-info-item">
                            <i class="fas fa-user-friends"></i>
                            <span>Age</span>
                            <strong id="ageRange">All Ages</strong>
                        </div>
                        <div class="quick-info-item">
                            <i class="fas fa-star"></i>
                            <span>Rating</span>
                            <strong id="rating">4.8</strong>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="info-card">
                    <h3 class="info-card-title">
                        <i class="fas fa-info-circle"></i>
                        About This Package
                    </h3>
                    <p class="package-description" id="description">Loading description...</p>
                </div>

                <!-- Itinerary -->
                <div class="info-card" id="itineraryCard" style="display: none;">
                    <h3 class="info-card-title">
                        <i class="fas fa-route"></i>
                        Itinerary
                    </h3>
                    <ul class="itinerary-list" id="itineraryList"></ul>
                </div>
            </div>

            <!-- Right Column - Booking Card -->
            <div>
                <div class="booking-card">
                    <!-- Price -->
                    <div class="price-display">
                        <span class="price-current" id="currentPrice">$0</span>
                        <span class="price-original" id="originalPrice" style="display: none;">$0</span>
                        <div class="price-per">per room</div>
                        <div class="discount-badge" id="discountBadge" style="display: none;">
                            <i class="fas fa-clock"></i>
                            <span id="discountEnds">Sale ends soon</span>
                        </div>
                    </div>

                    <!-- Availability -->
                    <div class="availability" id="availability">
                        <i class="fas fa-check-circle"></i>
                        <span id="availabilityText">Available</span>
                    </div>

                    <!-- Room Selector -->
                    <div class="booking-form-group">
                        <label>Number of Rooms</label>
                        <div class="room-selector">
                            <button type="button" class="qty-btn" onclick="updateRooms(-1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="qty-value" id="roomCount">1</span>
                            <button type="button" class="qty-btn" onclick="updateRooms(1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons" id="actionButtons">
                        <!-- Book Button - Creates booking for later payment -->
                        <button type="button" class="btn-book" id="bookBtn" onclick="bookPackage()">
                            <i class="fas fa-calendar-check"></i>
                            Book Now
                        </button>

                        <!-- Buy Now Button - Direct to payment -->
                        <button type="button" class="btn-buy-now" id="buyNowBtn" onclick="buyNow()">
                            <i class="fas fa-bolt"></i>
                            Buy Now - Direct Payment
                        </button>

                        <!-- Add to Cart Button -->
                        <button type="button" class="btn-add-cart" id="addCartBtn" onclick="addToCart()">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                    </div>

                    <!-- Waitlist Button (shown when sold out) -->
                    <div class="action-buttons" id="waitlistButtons" style="display: none;">
                        <button type="button" class="btn-waitlist" onclick="joinWaitlist()">
                            <i class="fas fa-bell"></i>
                            Join Waiting List
                        </button>
                    </div>

                    <div class="secure-notice">
                        <i class="fas fa-lock"></i>
                        <span>Secure SSL Payment</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">Message</span>
</div>

<script>
    let packageData = null;
    let selectedRooms = 1;
    let maxRooms = 10;

    // Get package ID from URL
    function getPackageId() {
        const path = window.location.pathname;
        const match = path.match(/\/packages?\/(\d+)/);
        return match ? parseInt(match[1]) : null;
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async function() {
        const packageId = getPackageId();
        if (!packageId) {
            showToast('Package not found', 'error');
            return;
        }
        await loadPackage(packageId);
    });

    // Load package details
    async function loadPackage(packageId) {
        try {
            const response = await fetch(`/api/packages/${packageId}`);

            if (!response.ok) {
                throw new Error('Package not found');
            }

            packageData = await response.json();
            renderPackage();
        } catch (error) {
            console.error('Error:', error);
            showToast('Failed to load package', 'error');
        }
    }

    // Render package details
    function renderPackage() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('packageContent').style.display = 'block';

        const pkg = packageData;

        // Hero
        const imageUrl = pkg.imageUrl || 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=1920';
        document.getElementById('heroImage').style.backgroundImage = `url('${imageUrl}')`;
        document.getElementById('packageTitle').textContent = pkg.destination || 'Package';
        document.getElementById('packageCountry').textContent = pkg.country || '';
        document.getElementById('typeBadge').textContent = pkg.packageType || 'Travel';

        // Check for discount
        const isOnSale = pkg.discountedPrice &&
            pkg.discountStartDate &&
            pkg.discountEndDate &&
            new Date() >= new Date(pkg.discountStartDate) &&
            new Date() <= new Date(pkg.discountEndDate);

        if (isOnSale) {
            document.getElementById('saleBadge').style.display = 'inline-flex';
            document.getElementById('currentPrice').textContent = `$${pkg.discountedPrice.toLocaleString()}`;
            document.getElementById('originalPrice').textContent = `$${pkg.price.toLocaleString()}`;
            document.getElementById('originalPrice').style.display = 'inline';
            document.getElementById('discountBadge').style.display = 'inline-flex';

            const endDate = new Date(pkg.discountEndDate);
            document.getElementById('discountEnds').textContent = `Sale ends ${endDate.toLocaleDateString()}`;
        } else {
            document.getElementById('currentPrice').textContent = `$${(pkg.price || 0).toLocaleString()}`;
        }

        // Quick info
        const startDate = pkg.startDate ? new Date(pkg.startDate) : null;
        const endDate = pkg.endDate ? new Date(pkg.endDate) : null;
        let duration = '-';
        if (startDate && endDate) {
            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            duration = `${days} days`;
        }
        document.getElementById('duration').textContent = duration;
        document.getElementById('rooms').textContent = `${pkg.availableRooms || 0} rooms`;

        // Age range
        let ageText = 'All Ages';
        if (pkg.minimumAge && pkg.maximumAge) {
            ageText = `${pkg.minimumAge}-${pkg.maximumAge}`;
        } else if (pkg.minimumAge) {
            ageText = `${pkg.minimumAge}+`;
        }
        document.getElementById('ageRange').textContent = ageText;

        // Description
        document.getElementById('description').textContent = pkg.description || 'No description available.';

        // Itinerary
        if (pkg.itinerary) {
            document.getElementById('itineraryCard').style.display = 'block';
            const lines = pkg.itinerary.split('\n').filter(line => line.trim());
            const itineraryList = document.getElementById('itineraryList');
            itineraryList.innerHTML = lines.map((line, index) => `
                <li class="itinerary-item">
                    <div class="itinerary-day">
                        <span>Day</span>
                        <strong>${index + 1}</strong>
                    </div>
                    <div class="itinerary-content">
                        <h4>${line.split(':')[0] || 'Day ' + (index + 1)}</h4>
                        <p>${line.split(':').slice(1).join(':').trim() || line}</p>
                    </div>
                </li>
            `).join('');
        }

        // Availability
        maxRooms = Math.min(pkg.availableRooms || 0, 10);
        const availabilityEl = document.getElementById('availability');
        const availabilityText = document.getElementById('availabilityText');

        if (pkg.availableRooms === 0) {
            availabilityEl.className = 'availability sold-out';
            availabilityText.innerHTML = '<i class="fas fa-times-circle"></i> Sold Out';
            document.getElementById('actionButtons').style.display = 'none';
            document.getElementById('waitlistButtons').style.display = 'flex';
        } else if (pkg.availableRooms <= 3) {
            availabilityEl.className = 'availability limited';
            availabilityText.innerHTML = `<i class="fas fa-exclamation-circle"></i> Only ${pkg.availableRooms} rooms left!`;
        } else {
            availabilityText.innerHTML = `<i class="fas fa-check-circle"></i> ${pkg.availableRooms} rooms available`;
        }
    }

    // Update room count
    function updateRooms(delta) {
        selectedRooms = Math.max(1, Math.min(maxRooms, selectedRooms + delta));
        document.getElementById('roomCount').textContent = selectedRooms;
    }

    // Book package (creates booking for later payment)
    async function bookPackage() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/account/login?returnUrl=' + encodeURIComponent(window.location.pathname);
            return;
        }

        try {
            const response = await fetch('/api/booking', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    packageId: packageData.packageId,
                    numberOfRooms: selectedRooms,
                    numberOfGuests: selectedRooms * 2
                })
            });

            const result = await response.json();

            if (result.success || response.ok) {
                showToast('Booking created! View in My Bookings.');
                setTimeout(() => {
                    window.location.href = '/booking/my-bookings';
                }, 1500);
            } else {
                showToast(result.message || 'Failed to create booking', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error creating booking', 'error');
        }
    }

    // Buy Now - direct to payment
    async function buyNow() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/account/login?returnUrl=' + encodeURIComponent(window.location.pathname);
            return;
        }

        try {
            // Create booking first
            const response = await fetch('/api/booking', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    packageId: packageData.packageId,
                    numberOfRooms: selectedRooms,
                    numberOfGuests: selectedRooms * 2
                })
            });

            const result = await response.json();

            if (result.success || response.ok) {
                // Redirect directly to payment
                const bookingId = result.data?.bookingId || result.bookingId;
                window.location.href = `/booking/payment/${bookingId}`;
            } else {
                showToast(result.message || 'Failed to process', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error processing request', 'error');
        }
    }

    // Add to cart
    async function addToCart() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/account/login?returnUrl=' + encodeURIComponent(window.location.pathname);
            return;
        }

        try {
            const response = await fetch('/api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    packageId: packageData.packageId,
                    numberOfRooms: selectedRooms,
                    numberOfGuests: selectedRooms * 2
                })
            });

            const result = await response.json();

            if (result.success) {
                showToast('Added to cart!');
            } else {
                showToast(result.message || 'Failed to add to cart', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error adding to cart', 'error');
        }
    }

    // Join waiting list
    async function joinWaitlist() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/account/login?returnUrl=' + encodeURIComponent(window.location.pathname);
            return;
        }

        try {
            const response = await fetch('/api/waitlist/join', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    packageId: packageData.packageId
                })
            });

            const result = await response.json();

            if (result.success) {
                showToast('Added to waiting list! We\'ll notify you when available.');
            } else {
                showToast(result.message || 'Failed to join waitlist', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error joining waitlist', 'error');
        }
    }

    // Toast notification
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toastMessage');
        const icon = toast.querySelector('i');

        toastMsg.textContent = message;
        toast.className = 'toast ' + type;
        icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
        toast.classList.add('show');

        setTimeout(() => toast.classList.remove('show'), 3000);
    }
</script>
